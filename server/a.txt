SELECT 
    m.sender_id, 
    m.receiver_id, 
    m.content, 
    m.content, 
    latest_msgs.other_id, 
    latest_msgs.latest_time, 
    latest_msgs.total_unread, 
    users.id, users.username,
    users.image
FROM messages m
JOIN (
    SELECT 
        CASE 
            WHEN sender_id = 3 THEN receiver_id
            ELSE sender_id
        END AS other_id,
        MAX(createdAt) AS latest_time,
    	COUNT(IF(read_status = 'no', 1, NULL)) as total_unread
    FROM messages
    WHERE sender_id = 3 OR receiver_id = 3
    GROUP BY other_id
) latest_msgs
ON (m.sender_id = latest_msgs.other_id OR m.receiver_id = latest_msgs.other_id)
   AND m.createdAt = latest_msgs.latest_time
JOIN users
ON users.id = latest_msgs.other_id;